'Roma'

Utilities for a widely dispersed replicated Redis cluster

Keywords: replication, cluster, partition, shard, sharding, Redis


==========
Contents
==========

* Poetic License
* Introduction
* Core utilities
  o roma
  o romad
  o roma-setup
  o roma-start
  o roma-stop
  o roma-status
  o roma-hash
  o roma-backup
  o roma-restore
* Roma Name


==========
Poetic License
==========

(c) 2010 Alexander E Genaud

This work ‘as-is’ we provide.
No warranty express or implied.
We’ve done our best,
to debug and test.
Liability for damages denied.

Permission is granted hereby,
to copy, share, and modify.
Use as is fit,
free or for profit.
On this notice, these rights rely.


==========
Introduction
==========

Roma is a set of utilities that help query and maintain a replicated
partitioned (shared) Redis cluster. It handles start, stop, status,
backup, restore, arbitrary queries, and includes a monitoring daemon
(romad) which handles fail-over, periodic backups, and establishes
the cluster status.

The cluster has a single roma.conf configuration file which defines
the number of partitions and all of the nodes in the cluster.
Roma.conf includes the hostname, port, database, and partition of
every Redis node in the cluster.

A node is a Redis instance which may be either a data node or a
status node. Data nodes are bound to a single partition. A single
master and any number of slaves are assigned 1-1 to a partition
(modulo hash value). Data nodes are presumed to be dead until
promoted to slave or master by a romad monitor. Romad broadcast
status to all status nodes. Clients and proxies are expected to poll
the status nodes.

Romad cluster monitoring daemons are responsible for assigning the
status of data nodes as master, slave, or dead. Romad compete with
each other for the role of alpha. The alpha is responsible for
fail-over and reporting the cluster status. Other romad exist should
the alpha fail.

The cluster is maintained by many small utilities. This allows, for
example, the partition sharding hash function to be a replaced or any
backup regime. Utilities can be eliminated as cluster features are
implemented in the core Redis runtime (which should continue to be
back/forward compatible).


==========
Core utilities
==========

roma
  wraps redis-cli, but hashes the key
  and executes the command on the
  appropriate partition (shard)

romad
  daemon (of which there may be many)
  which monitors the cluster. It
  competes with any other romad for
  alpha position. The alpha sets the
  cluster status and handles fail-over.
  It can be configured to send an email
  if the status is HALT or any Redis
  node is down for more than x seconds.

roma-setup
  creates the entire cluster plumbing
  including all partitions and redis.conf
  according to the roma.conf. Ignores
  the hostname (results must be moved
  manually to other machines)

roma-start
  starts the entire cluster according
  to the roma.conf configuration file
  (must be run separately per machine)

roma-stop
  stops the entire cluster according
  to the roma.conf configuration file

roma-status
  returns the cluster status in various
  formats: summary, list, xml, html

roma-hash
  A plug-able hash function wrapper
  which accepts two arguments:
  a single 7-bit ASCII string (key)
  and a modulus (number of partitions).
  It returns the partition number.

roma-backup
  backs up the entire cluster to
  directory(ies) according to roma.conf

roma-restore
  overwrites all cluster data from a
  previous backup.


==========
Roma Name
==========

Why Roma? Well, it seems appropriate for two and a half reasons. The
Redis' core developer, while not from Rome, is Italian. Roma refers
to a people widely dispersed throughout the world, also known as
Redis (plural Redi).
